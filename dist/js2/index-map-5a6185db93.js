var map=new AMap.Map("container",{resizeEnable:!0,zoom:13});function poiPickerReady(a){window.poiPicker=a;new AMap.Marker,new AMap.InfoWindow({offset:new AMap.Pixel(0,-20)});a.on("poiPicked",function(a){var e=a.item.name,t=a.item.location.lng,n=a.item.location.lat;$("#pickerInput").val(e);var i,o={};o.name=e,o.lng=t,o.lat=n,i=JSON.stringify(o),sessionStorage.setItem("toaddress4",i)}),a.onCityReady(function(){})}AMapUI.loadUI(["misc/PoiPicker"],function(a){poiPickerReady(new a({input:"pickerInput"}))});var driving=new AMap.Driving({map:map,panel:"panel"});function loadmap(){var a,e,t=$(".type-navs-active").index(".type-navs"),n=localStorage.getItem("area");if(n?$("#tip").html(n):(alert("请先选择所在地区"),window.location.href="select-area.html"),0==t){if(a=JSON.parse(sessionStorage.getItem("toaddress1")),e=JSON.parse(sessionStorage.getItem("toaddress2")),a&&e){var i=a.lng,o=a.lat,s=e.lng,r=e.lat;driving.search(new AMap.LngLat(i,o),new AMap.LngLat(s,r),function(){var a,e=$(".planTitle p").text().match(/\(([^)]*)\)/)[1],t=parseFloat(e);$("#distance").html(t);var n=JSON.parse(sessionStorage.getItem("Regulation1")),i=parseFloat(n.initialMoney),o=parseFloat(n.kmRange.split("-")[0]),s=parseFloat(n.kmRange.split("-")[1]),r=parseFloat(n.kmValuation),l=parseFloat(n.valuation);t<=o?a=i:o<t&&t<s?a=i+(t-o)*r:s<=t&&(a=i+(s-o)*r+(t-s)*l),console.log(a),$("#finish-price2").html(a.toFixed(2));var p=a+parseFloat($("#award3").text());$("#finish-price").html(p.toFixed(2))})}}else if(3==t&&(a=JSON.parse(sessionStorage.getItem("toaddress7")),e=JSON.parse(sessionStorage.getItem("toaddress8")),a&&e)){i=a.addressLng,o=a.addressLat,s=e.addressLng,r=e.addressLat;driving.search(new AMap.LngLat(i,o),new AMap.LngLat(s,r),function(){var a,e=$(".planTitle p").text().match(/\(([^)]*)\)/)[1],t=parseFloat(e),n=JSON.parse(sessionStorage.getItem("Regulation2")),i=parseFloat(n.initialMoney),o=parseFloat(n.kmRange.split("-")[0]),s=parseFloat(n.kmRange.split("-")[1]),r=parseFloat(n.kmValuation),l=parseFloat(n.valuation);$("#main4-distance").html(t),t<=o?a=i:o<t&&t<s?a=i+(t-o)*r:s<=t&&(a=i+(s-o)*r+(t-s)*l),$("#main4-reward").html(a);var p=a+parseFloat($("#main4-award").text());$("#main4-finish").html(p.toFixed(2))})}}setTimeout(function(){loadmap()},500);