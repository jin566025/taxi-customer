$(function(){var e=localStorage.getItem("userId");e||($.ajax({type:"post",url:url_path+"/wx/queryAppId.json",dataType:"json",success:function(e){if("成功"==e.msg){var t=e.appId,s=e.appSecret;sessionStorage.setItem("appSecret",s),localStorage.setItem("appId",t);var i=sessionStorage.getItem("code"),o=window.location.href.split("userOpenid=")[1];if(o){var a=o.split("?type=")[0],n=o.split("?type=")[1];sessionStorage.setItem("userOpneid",a),sessionStorage.setItem("userType",n)}i||(window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t+"&redirect_uri=http%3a%2f%2ftaxicustomer.nbzhidun.com%2findex.html&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}},error:function(){}}),function(){var e=window.location.href.split("code=")[1];if(e){var t=e.split("&")[0];sessionStorage.setItem("code",t)}}());var t=localStorage.getItem("hasLogin"),s=localStorage.getItem("openid");function o(e){return/^1[34578]\d{9}$/.test(e)}t&&s&&e&&(window.location.href="index2.html"),$(".login-btn").click(function(){var e,t,s,i;e=url_path,t=$("#username").val(),s=$("#ymz").val(),i=sessionStorage.getItem("code"),o(t)?""==s?$("#tips2").css("visibility","visible").html("请输入验证码"):$.ajax({type:"post",url:e+"/user/login.json",data:{username:t,validateCode:s,code:i},dataType:"json",success:function(e){console.log(e),"用户不存在"==e.msg?($("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html("")):"成功"==e.msg?(localStorage.setItem("hasLogin",!0),localStorage.setItem("usernickname",e.nickname),localStorage.setItem("userscore",e.score),localStorage.setItem("userId",e.userId),localStorage.setItem("userImg",e.userImg),localStorage.setItem("openid",e.userOpenid),localStorage.setItem("token",e.token),window.location.href="index2.html"):($("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html(""))}}):$("#tips1").css("visibility","visible").html("请输入正确的手机号码")}),$("#send-yzm").click(function(){!function(e){var t=$("#username").val();if(o(t)){$("#tips1").css("visibility","hidden");var s=60;$("#send-yzm").addClass("disabled");var i=setInterval(function(){s-=1,$("#send-yzm").html(s)},1e3);setTimeout(function(){$("#send-yzm").html("点击发送验证码").removeClass("disabled"),window.clearInterval(i)},6e4),$.ajax({type:"get",url:e+"/user/getLoginSMS.json",dataType:"json",data:{username:t},success:function(e){console.log(e),e.msg},error:function(e){console.log(e)}})}else $("#tips1").css("visibility","visible").html("请输入正确的手机号码")}(url_path)})});