var map=new AMap.Map("container",{resizeEnable:!0,zoom:13});function poiPickerReady(e){window.poiPicker=e;new AMap.Marker,new AMap.InfoWindow({offset:new AMap.Pixel(0,-20)});e.on("poiPicked",function(e){var a=e.item.name,t=e.item.location.lng,i=e.item.location.lat;$("#pickerInput").val(a);var n,o={};o.name=a,o.lng=t,o.lat=i,n=JSON.stringify(o),sessionStorage.setItem("toaddress4",n)}),e.onCityReady(function(){})}AMapUI.loadUI(["misc/PoiPicker"],function(e){poiPickerReady(new e({input:"pickerInput"}))});var driving=new AMap.Driving({map:map,panel:"panel"});function loadmap(){var e,a,t=$(".type-navs-active").index(".type-navs"),i=localStorage.getItem("area");if(i?$("#tip").html(i):(alert("请先选择所在地区"),window.location.href="select-area.html"),0==t){if(e=JSON.parse(sessionStorage.getItem("toaddress1")),a=JSON.parse(sessionStorage.getItem("toaddress2")),e&&a){var n=e.lng,o=e.lat,r=a.lng,s=a.lat;driving.search(new AMap.LngLat(n,o),new AMap.LngLat(r,s),function(){var e=$(".planTitle p").text().match(/\(([^)]*)\)/)[1],a=parseFloat(e);$("#distance").html(a);var t=sessionStorage.getItem("Regulation1");(t=JSON.parse(t)).initialMileage,t.initialMoney,t.valuation;a<=2?price=5:2<a&&a<5?price=5+1.5*(a-2):5<=a&&(price=5+1.5*(a-2)+2.25*(a-5)),$("#finish-price2").html(price.toFixed(2));var i=parseFloat($("#award3").text()),n=price+i;$("#finish-price").html(n.toFixed(2))})}}else if(3==t&&(e=JSON.parse(sessionStorage.getItem("toaddress7")),a=JSON.parse(sessionStorage.getItem("toaddress8")),e&&a)){n=e.addressLng,o=e.addressLat,r=a.addressLng,s=a.addressLat;driving.search(new AMap.LngLat(n,o),new AMap.LngLat(r,s),function(){var e,a=$(".planTitle p").text().match(/\(([^)]*)\)/)[1],t=parseFloat(a),i=sessionStorage.getItem("Regulation2"),n=(i=JSON.parse(i)).initialMileage,o=i.initialMoney,r=i.valuation;$("#main4-distance").html(t),e=n<t?parseFloat(o+(t-n)*r):parseFloat(o.toFixed(2)),console.log(e),$("#main4-reward").html(e);var s=e+parseFloat($("#main4-award").text());$("#main4-finish").html(s.toFixed(2))})}}setTimeout(function(){loadmap()},500);