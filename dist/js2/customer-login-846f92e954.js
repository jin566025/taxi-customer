$(function(){localStorage.getItem("userId")||($.ajax({type:"post",url:url_path+"/wx/queryAppId.json",dataType:"json",success:function(e){if("成功"==e.msg){var s=e.appId;e.appSecret,localStorage.setItem("appId",s);var t=sessionStorage.getItem("code"),i=window.location.href.split("userOpenid=")[1];if(i){var o=i.split("?type=")[0],a=i.split("?type=")[1];sessionStorage.setItem("userOpneid",o),sessionStorage.setItem("userType",a)}"undefined"!=t&&"null"!=t||(window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+s+"&redirect_uri=http%3a%2f%2ftaxicustomer.nbzhidun.com%2findex.html&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")}},error:function(){}}),function(){var e=window.location.href.split("code=")[1];if(e)var s=e.split("&")[0];sessionStorage.setItem("code",s),s&&$.ajax({type:"post",url:url_path+"/getAccessToken.json",data:{code:s},dataType:"json",async:!1,success:function(e){console.log(e);var s=e.openid;sessionStorage.setItem("openid",s),localStorage.setItem("openid",s),localStorage.setItem("token",e.token);var t=sessionStorage.getItem("userOpneid"),i=sessionStorage.getItem("userType");t&&$.ajax({type:"post",url:url_path+"/saveSubordinate.json",async:!1,data:{userOpneid:t,type:i,openid:s},dataType:"json",success:function(e){alert(e)}}),$.ajax({type:"post",url:url_path+"/user/loginOauth.json",async:!1,data:{userOpenid:s},dataType:"json",success:function(e){if("成功"==e.msg){var s=e.nickname,t=e.score,i=e.userId,o=e.userImg;localStorage.setItem("usernickname",s),localStorage.setItem("userscore",t),localStorage.setItem("userId",i),localStorage.setItem("userImg",o)}}})}})}());var e=localStorage.getItem("hasLogin"),s=localStorage.getItem("openid");function o(e){return/^1[34578]\d{9}$/.test(e)}e&&s&&(window.location.href="index2.html"),$(".login-btn").click(function(){var e,s,t;e=url_path,s=$("#username").val(),t=$("#ymz").val(),o(s)?""==t?$("#tips2").css("visibility","visible").html("请输入验证码"):$.ajax({type:"post",url:e+"/user/login.json",data:{username:s,validateCode:t},dataType:"json",success:function(e){"用户不存在"==e.msg?($("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html("")):"成功"==e.msg?(localStorage.setItem("hasLogin",!0),window.location.href="index2.html"):($("#tips1").css("visibility","visible").html(e.msg),$("#tips2").css("visibility","hidden").html(""))}}):$("#tips1").css("visibility","visible").html("请输入正确的手机号码")}),$("#send-yzm").click(function(){!function(e){var s=$("#username").val();if(console.log(s),o(s)){$("#tips1").css("visibility","hidden");var t=60;$("#send-yzm").addClass("disabled");var i=setInterval(function(){t-=1,$("#send-yzm").html(t)},1e3);setTimeout(function(){$("#send-yzm").html("点击发送验证码").removeClass("disabled"),window.clearInterval(i)},6e4),$.ajax({type:"get",url:e+"/user/getLoginSMS.json",dataType:"json",data:{username:s},success:function(e){console.log(e),console.log(s),e.msg},error:function(e){console.log(e)}})}else $("#tips1").css("visibility","visible").html("请输入正确的手机号码")}(url_path)})});