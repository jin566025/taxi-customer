$(function(){setTimeout(function(){$(".amap-logo,.amap-controls").hide(),$(".amap-copyright,.amap-controls").css("visibility","hidden")},500);var n,i=window.location.href.split("=")[1];function t(t,n){$.ajax({type:"post",url:url_path+"/mission/ok.json",async:!0,data:{id:t,userId:n},dataType:"json",success:function(n){"成功"==n.msg&&(window.location.href="to-access.html?taslId="+t)},error:function(){}})}n=i,$.ajax({type:"post",url:url_path+"/mission/info.json",data:{id:n},dataType:"json",success:function(n){if(console.log(n),"成功"==n.msg){var t=n.state,e=n.typeId,i=n.award,a=n.finish,o=n.message,s=n.goodsType,r=n.driverNickname,c=n.matmoney,d=n.reward;$(".main-content"+t).show(),sessionStorage.setItem("driverId",n.driverId);var m=(f=n.pickupTime,(v=new Date(parseInt(f))).getFullYear()+"-"+(v.getMonth()+1)+"-"+v.getDate()+" "+v.getHours()+":"+v.getMinutes()+":"+v.getSeconds());2==t?($("#main-content2-finish").html(i),$("#main-content2-award").html(a),$("#main-content2-pickupTime").html(m),$("#main-content2-message").html(o),$("#main-content2-type").html(s),$("#main-content2-name").html(r),$("#main-content2-head").attr("src",n.driverImgUrl),$("#main-content2-driverGrade").html(n.driverGrade),$("#main-content2-driverCarNum").html(n.driverCarNum),$(".driverTel").attr("href","tel:"+n.driverTel),1==e?$(".types2").hide():2==e?($(".types1").hide(),$(".main-top-content-p3").hide(),$("#main-content2-award").html(d),$(".dzzj").html(c)):3==e&&($("#main-top").hide(),$("#main-mid").hide(),$(".section2").hide(),$(".main2").removeClass("section3"),$(".tocomplain").remove(),$(".order2-mid-navs").css("width","50%"))):1==t?1==e?($(".types2").hide(),$("#main-content2-finish").html(i),$("#main-content2-award").html(a),$(".main-top-container2-input").hide()):2==e?($("#main-bottom").css("margin-top","10px"),$(".main-top-container").hide(),$(".main-top-content-p3").hide(),$("#main-mid").hide(),$(".main-top-container3").removeClass("hide"),$(".main-top-container3-p1").show(),$(".main-top-container2-price").html(c).attr("changid","1"),$(".main-top-container2-input").val(o),$(".edit").show()):3==e&&($("#main-top").hide(),$("#main-mid").hide(),$(".section2").hide(),$(".main2").removeClass("section3"),$(".tocomplain").remove(),$(".order2-mid-navs").css("width","50%")):3==t&&($("#main-content3-finish").html(a),$("#main-content3-award").html(i),$("#main-content3-time").html(m),$("#main-content3-message").html(o),$("#main-content3-type").html(s),$("#main-content3-name").html(r),$("#main-content3-head").attr("src",n.driverImgUrl),$("#main-content3-grade").html(n.driverGrade),$("#main-content3-carnum").html(n.driverCarNum),$(".driverTel").attr("href","tel:"+n.driverTel),1==e?$(".main2-section-p-container1").hide():2==e?($(".main2-section-p-container1-price").html(c),$(".main2-section-p-container1-message").html(o),$(".main-top-content-p3").hide(),$(".main2-section-p-container2").hide(),$("#main-content3-finish").html(a)):3==e&&($(".main").removeClass("section3"),$(".section2").hide()));var l=n.deliveryAddressLatitude,h=n.deliveryAddressLongitude,p=n.goodsType,i=n.award,a=n.finish,u=n.taskAddressLatitude,g=n.taskAddressLongitude;driving.search(new AMap.LngLat(h,l),new AMap.LngLat(g,u)),$("#goodsType").html(p),$("#reward").html(i),$("#message").html(n.message),$("#matmoney").html(a)}var f,v},error:function(){}}),$(".main-top-container2-price").click(function(){1==$(this).attr("changid")&&($(".dialog4").fadeIn(),$("#shadow").fadeIn())}),$(".dialog-btns1 ").click(function(){$("#shadow").fadeOut(500),$(".dialogs").fadeOut(500)}),$(".edit").click(function(){$(".dialog5").fadeIn(),$("#shadow").fadeIn()}),$("#main-content2-submit").click(function(){$("#shadow").fadeIn(500),$(".dialog2").fadeIn(500)}),$(".dialog-sure1").click(function(){t(i,userId)}),$(".cancle-orders").click(function(){$("#shadow").fadeIn(500),$(".dialog3").fadeIn(500)}),$(".dialog-sure2").click(function(){var n,t,e;n=i,t=userId,e=!1,$.ajax({type:"post",url:url_path+"/mission/getUserCancelNum.json",async:!1,data:{userId:t},dataType:"json",success:function(n){console.log(n),"成功"==n.msg&&(n.cancelNum<4?e=!0:(alert("每日超过3次不能免费取消"),e=!1))},error:function(){}}),e&&$.ajax({type:"post",async:!1,url:url_path+"/mission/cancel.json",data:{id:n,userId:t},dataType:"json",success:function(n){console.log(n),"成功"==n.msg&&(alert("每日免费取消次数为3次"),history.go(-1))},error:function(){}})}),$(".complete-order").click(function(){t(i,userId)}),$(".toaccesss").click(function(){window.location.href="to-access.html?taslId="+i}),$(".tocomplain").click(function(){var n=sessionStorage.getItem("driverId");setTimeout(function(){window.location.href="complain.html?taslId="+i+"="+n},500)})});