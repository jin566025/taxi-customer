var map=new AMap.Map("container",{resizeEnable:!0,zoom:13});function poiPickerReady(a){window.poiPicker=a;new AMap.Marker,new AMap.InfoWindow({offset:new AMap.Pixel(0,-20)});a.on("poiPicked",function(a){var e=a.item.name,t=a.item.location.lng,i=a.item.location.lat;$("#pickerInput").val(e);var n,o={};o.name=e,o.lng=t,o.lat=i,n=JSON.stringify(o),sessionStorage.setItem("toaddress4",n)}),a.onCityReady(function(){})}AMapUI.loadUI(["misc/PoiPicker"],function(a){poiPickerReady(new a({input:"pickerInput"}))});var driving=new AMap.Driving({map:map,panel:"panel"});function loadmap(){var a,e,t=$(".type-navs-active").index(".type-navs"),i=localStorage.getItem("area");if(i?$("#tip").html(i):(alert("请先选择所在地区"),window.location.href="select-area.html"),0==t){if(a=JSON.parse(sessionStorage.getItem("toaddress1")),e=JSON.parse(sessionStorage.getItem("toaddress2")),a&&e){var n=a.lng,o=a.lat,r=e.lng,s=e.lat;driving.search(new AMap.LngLat(n,o),new AMap.LngLat(r,s),function(){var a=$(".planTitle p").text().match(/\(([^)]*)\)/)[1],e=parseFloat(a);$("#distance").html(e);var t=sessionStorage.getItem("Regulation1"),i=parseFloat(t.initialMoney),n=parseFloat(t.kmRange.split("-")[0]),o=parseFloat(t.kmRange.split("-")[1]),r=parseFloat(t.kmValuation),s=parseFloat(t.valuation);e<=n?price=i:n<e&&e<o?price=i+(e-n)*r:o<=e&&(price=i+(o-n)*r+(e-o)*s),$("#finish-price2").html(price.toFixed(2));var l=parseFloat($("#award3").text()),p=price+l;$("#finish-price").html(p.toFixed(2))})}}else if(3==t&&(a=JSON.parse(sessionStorage.getItem("toaddress7")),e=JSON.parse(sessionStorage.getItem("toaddress8")),a&&e)){n=a.addressLng,o=a.addressLat,r=e.addressLng,s=e.addressLat;driving.search(new AMap.LngLat(n,o),new AMap.LngLat(r,s),function(){var a,e=$(".planTitle p").text().match(/\(([^)]*)\)/)[1],t=parseFloat(e),i=(sessionStorage.getItem("Regulation2"),parseFloat(Regulation1.initialMoney)),n=parseFloat(Regulation1.kmRange.split("-")[0]),o=parseFloat(Regulation1.kmRange.split("-")[1]),r=parseFloat(Regulation1.kmValuation),s=parseFloat(Regulation1.valuation);$("#main4-distance").html(t),t<=n?a=i:n<t&&t<o?a=i+(t-n)*r:o<=t&&(a=i+(o-n)*r+(t-o)*s),$("#main4-reward").html(a);var l=a+parseFloat($("#main4-award").text());$("#main4-finish").html(l.toFixed(2))})}}setTimeout(function(){loadmap()},500);